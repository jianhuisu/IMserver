## swoole

##### CSP 并发编程模型

CSP ，全称:`Communicating Sequential Process`，是一种并发编程模型.
最初于Tony Hoare的1977年的论文中被描述，影响了许多编程语言的设计。用于描述两个的ulinix并发的实体通过共享的通讯管道（channel)进行通信的 并发模型。
在该模型中，`channel`是比较重要的对象，它并不关注发送消息的实体，而只关心与发送消息时实体使用的channel

区别于`Actor`模型

##### 异步 与 协程 

swoole 的异步与协程是两个独立的概念， 

异步是编程思路，模型.比如我们可以通过事件回调来实现异步调用.
协程是思路的一种实现,通过合理的调度,达到异步编程的性能.

快速启动中的例子大部分都是异步风格的编程模式，用协程风格同样可以做到例子中的功能。
`https://wiki.swoole.com/#/start/start_server`

##### 什么是协程

协程可以简单理解为线程，只不过这个线程是用户态的，不需要操作系统参与，创建销毁和切换的成本非常低，
和线程不同的是协程没法利用多核`cpu`的，想利用多核`cpu`需要依赖`Swoole`的多进程模型。

 - 协程是一种用户态的线程 
 - 一个线程可以有多个协程 
 - 一个进程可以有多个协程  
 - 协程主要依赖于 c 的 setjmp longjmp (类似于 goto )的实现

`channel`可以理解为消息队列，只不过是协程间的消息队列，多个协程通过 `push` 和 `pop` 操作生产消息和消费消息，用来协程之间的通讯。
注意: **`channel` 是没法跨进程的，只有同一个`Swoole`进程里的协程才能同通讯**.

##### swoole 协程调度

用户的每个请求都会创建一个协程，请求结束后协程结束，如果同时有成千上万的并发请求，**某一时刻某个进程内部会存在成千上万的协程**.

协程是非抢占型调度
线程是抢占型调度

 1. 协程代码段中发现代码遇到了，`Co::sleep()` 或者产生了`网络IO`,例如`MySQL->query()`,`Swoole`就会把这个`Mysql`连接的`Fd`放到 `EventLoop` 中
 1. 协程主动出让CPU给其它协程使用.`yield`
 1. 等待`MySQL`数据返回后就继续执行这个协程,`resume`

eg. 

    go(function () {
        MySQL->query(); 
    });

协程的创建、切换、挂起、销毁全部为内存操作，消耗是非常低的,所以程序仅启动了一个1个进程，就可以并发处理大量请求。
程序的性能基本上与异步回调方式相同，但是代码完全是同步编写的.

