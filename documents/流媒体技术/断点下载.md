Range &Content-Range &Accept-Ranges

http协议从1.1开始支持获取文件的部分内容，这为并行下载以及断点续传提供了技术支持。

如对于一个多线程下载工具，服务器端把文件分割成多个部分，比如4个部分（如文件大小为403个 byte，那么可能的分割方式可以为：
0-99 (前100个字节)，100-199(第二个100字节)，200-299(第三个100字节)，300-402（最后103个字节）），然后对应4个线程，客户端每个线程负责下载一个部分。
现在的问题是线程3发送一个什么样的请求报文，才能够保证 只请求文件的200-299字节，而不会干扰其他线程的任务。

再有如果一个线程进行上传/下载过程中碰到网络故障，我们希望可以从已经上传/下载的部分开始继续上传/下载未完成的部分，
而没有必要从头开始上传/下载。可以节省时间，和网络资源。

HTTP1.1中上述问题的解决方法是通过在请求/响应的Header里设置参数实现的，客户端发请求时对应的是Range，服务器端响应时对应的是Accept-Ranges、Content-Range。

如果Server支持分段下载，那么在客户端请求资源之前，首先要告诉客户端，它支持Range，之后客户端才可能发起带Range的请求。

如在如下一个页面中下载某个资源的时候，server 主动告诉 client “Accept-Ranges: bytes”。
Server通过请求头中的`Range:bytes=xxx-xxx`（xxx-xxx表示字节范围，字节数从0开始计数）来判断是否是做Range请求，

 - 如果这个值存在而且有效，则只发回请求的那部分文件内容，响应的状态码变成`206`，表示`Partial Content`，并设置`Content-Range`。
 - 如果无效，则返回416状态码，表明`Request Range Not Satisfiable`，如果不包含Range的请求头，则继续通过常规的方式响应。


Range头域 Range头域可以请求实体的一个或者多个子范围。
例如，

 - 表示头500个字节：bytes=0-499
 - 表示第二个500字节：bytes=500-999
 - 表示最后500个字节：bytes=-500
 - 表示500字节以后的范围：bytes=500-
 - 第一个和最后一个字节：bytes=0-0,-1
 - 同时指定几个范围：bytes=500-600,601-999
 
服务器可以忽略此请求头，if accept Range请求头，响应会以状态码206（PartialContent）返回而不是以200 （OK）。
        

作者：mysimplebook
链接：https://www.jianshu.com/p/c13b92a8ae31
来源：简书
著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。
