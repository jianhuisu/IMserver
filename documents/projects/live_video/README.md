## 视频编码 

视频是连续的图像序列，由连续的帧构成，一帧即为一幅图像。由于人眼的视觉暂留效应，当帧序列以一定的速率播放时，我们看到的就是动作连续的视频。
**由于连续的帧之间相似性极高，为便于储存传输，我们需要对原始的视频进行编码压缩，以去除空间、时间维度的冗余**。

##### 编码压缩常用的算法

视频信号数字化后数据带宽很高，通常在20MB/秒以上，采用压缩技术通常数据带宽降到1-10MB/秒

编码压缩常用的算法

 - JPEG   适用于静态图像压缩标准
 - MPEG   适用于动态视频的压缩算法  
 - AVS    AVS音视频编码是中国支持制订的新一代编码标准  压缩效率比MPEG-2增加了一倍以上

##### 直播转码 

直播实时转码功能是为了适应不同终端/网络环境下的多码率需求，其中，原始视频：该选项为必选项，不可以不选，表示维持直播源的原始分辨率和码率(包括视频和音频).

码率

视频码率就是数据传输时单位时间传送的数据位数，一般我们用的单位是kbps即千位每秒。通俗一点的理解就是取样率，单位时间内取样率越大，精度就越高，处理出来的文件就越接近原始文件。
但是文件体积与取样率是成正比的，所以几乎所有的编码格式重视的都是如何用最低的码率达到最少的失真，围绕这个核心衍生出来的cbr（固定码率）与vbr（可变码率）

码率几点原则：

 1. 码率和质量成正比，但是文件体积也和码率成正比。
 1. 码率超过一定数值，对图像的质量没有多大影响。

分辨率

	流畅
	高清
	超清
	蓝光4M
	 
##### Protocol
 
HLS的工作原理简单来说就是把一段视频流，分成一个个小的基于HTTP的文件来下载。当媒体流正在播放时，客户端可以根据当前网络环境，方便地在不同的码率流中做切换，以实现更好的观影体验。

RTMP是`Real Time Messaging Protocol`（实时消息传输协议）的首字母缩写。该协议基于TCP，是一个协议族，包括RTMP基本协议及`RTMPT`/`RTMPS`/`RTMPE`等多种变种。
`RTMP`是一种设计用来进行实时数据通信的网络协议，主要用来在`Flash`/`AIR`平台和支持RTMP协议的流媒体/交互服务器之间进行音视频和数据通信。
支持该协议的软件包括`Adobe Media Server`/`Ultrant Media Server`/`red5`等。`RTMP`与`HTTP`一样，都属于`TCP`/`IP`四层模型的应用层。

##### m3u8 and mp4 

项目最近需要在网站播放mp4视频，第一印象自让是使用h5的video标签。这个比较方便，生成视频地址作为video标签的src值即可。
在本地播放还好，但是上传到服务器上比较慢，更何况服务器在国外，加载时特别慢，好几分钟。

解决办法有2种：

###### mehtod.1 大mp4切割为多个小mp4 循环播放

将`mp4`切分为多个小`mp4`文件，`src`作为动态传值，循环小`mp4`的列表。主要是监听`end`事件，回调里面把`video`的`src`改成列表的下一个。但是在保证视频质量的前提下，总的视频大小还是跟源视频文件相差不大。

###### method.2 将mp4转换成m3u8格式

Apple 为了提高流播效率开发的技术，特点是将流媒体切分为若干`TS`片段（比如每10秒一段），然后通过一个扩展的`m3u`列表文件将这些`TS`片段集中起来供客户端播放器接收。
以`M3U8`为例:`m3u8`由2部分组成，分别是`m3u8`和`ts`文件。切分后有`n`个`ts`文件（取决于切分时设置每片时长），`m3u8`文件就是多个ts文件组成的序列，其实就是一个文本。
在开始一个流媒体会话时，客户端会下载一个包含元数据的extended M3U (m3u8)playlist文件，用于寻找可用的媒体流。
（源视频文件为220M，切分后多个ts文件总和才23M，并且视频质量不变。）m3u8视频同样可以使用video标签播放.

##### 直播流程图

    push Client -> push live data to media server
    pull Client -> pull live data from media server 
    
`pull`拉 `poll`投票......

 - push terminal    采集 编码 封包 RTMP推流
 - pull terminal    拉流 解码 播放 TRMP拉流
 - server terminal  媒体服务器 切片/转码/存储//输出      
     
所以 开发时可以需要从媒体服务器获取一个可用的推流地址,然后向该地址推流.向客户提供对应的拉流地址即可.(中间需要接入媒体服务器提供的编码解码压缩sdk)开发者只需要关心其他业务逻辑即可.
直播录制视频的获取可以起一个异步任务拉取到自己的服务器，然后进行处理.


     
##### 方案选择

HLS 主要应用在移动端.

跨平台：PC主要的直播方案是RTMP，也有一些库能播放HLS，譬如jwplayer，基于osmf的hls插件也一大堆。所以实际上如果选一种协议能跨 PC/Android/IOS，那就是HLS。
IOS上苛刻的稳定性要求：IOS上最稳定的当然是HLS，稳定性不差于RTMP在PC-flash上的表现。


##### 视频直播有哪些计费项


 1. 基础费用：流量/带宽费用，即您开启直播后，使用直播加速服务产生的流量/带宽费用。您可以在视频直播控制台的概览页自行选择按流量或带宽计费
 1. 存储空间费用
 1. 技术支持费用
 1. 智能鉴黄
 1. 直播截图 
 1. 直播转码  
 1. 点播相关增值服务.(直播回放的存储、编辑、转码、播放) 点播就是我们最常见的点击播放
 1. IM增值业务

##### 直播录制支持什么录制格式和播放格式？

目前直播录制支持录制至OBS和录制至VOD两种方式，具体支持的格式如下所示：

录制至OBS：仅支持录制生成hls格式的录制文件。若您需要其它播放格式，可以在录制前，对存储的OBS桶进行点播授权。录制文件将存储在OBS桶，并托管给点播服务，您可以在视频点播服务中对录制文件进行转码或转封装处理。
录制至VOD：支持flv录制格式，并同时支持录制转码成hls和mp4的播放格式，即您可以在配置录制规则时，选择“录制转码格式”，录制文件生成后，立即进行转封装处理。
