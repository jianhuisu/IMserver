## 设计模式 - 单例模式   
    
### 应用场景

数据库连接实例采用单例模式(因为HTTP是无状态的协议,所以php与mysql的连接方式多选用短连接)

 - 单例在系统中只存在一个对象实例，因此任何地方使用此对象都是一个对象,避免多实例创建使用时产生逻辑错误。
 - 提高创建速度，每次都获取已经存在的对象,因此提高创建速度.
 - 一个HTTP请求只会创建一个mysql连接实例,降低mysql连接打满的风险,减少同时创建多个mysql连接时的创建连接开销.

长连接/短连接

    短连接 : 客户端连接--创建socket认证连接道--维护连接--数据传输--关闭连接
    长连接 :客户端连接--创建socket认证连接--维护连接--数据传输--维护连接--数据传输.....-关闭连接

单进程图可以对映我们在命令行执行php脚本，MINT,RINT执行后执行我们的脚本代码,然后执行RSHUTDOWN,MSHUTDOWN就结束了。 
多进程图可以对映php-fpm的方式,一个进程MINT后，循环执行RINT,RSHUTDOWN，循环处理很多请求直到该进程要销毁执行MINT，然后结束。
 
那么理所当然的是我们打开的数据库连接句柄也会被释放，但是这只限于我们打开连接的时候使用的是短链接.
看官方文档我们可知道如果你打开的是长连接，在请求处理完后php会收留在本次打开的连接(即使你主动关闭也不会关闭而被收留),在下次有打开相同连接的请求时php会把收留的句柄直接给出去，
就免去了建立连接的过程效率更高。这个收留的域是MINT,MSHUTDOWN之间也就对应我们php-fpm的一个子进程存活期。
好了，现在我们想，php-fpm子进程数固定，一个子进程收留一个连接(假设打开的都是同一个数据库)给这个进程处理的所有页面用,
那么我数据库连接的数量就应该和我php-fpm子进程的数量一样无论我们处理多少个页面，这样效果就和一个连接池差不多了。 
这样配置php-fpm子进程数实现的伪连接池也要配合数据库的一些配置才好使，比如数据库允许连接数要大于php-fpm子进程数,
如mysq再配置一下wait_timeout 和interactive_timeout控制连接时长当一个连接很长时间没活动的时候mysql就关闭它，
php活动时这边会重新建立新连接。这样避免时间长了mysql有一大堆不活动的连接。    

基本上如果没有特殊说明，我们平时用的php框架都采用短连接的方式与mysql通信.php中没有mysql连接池的概念.(php-fpm实现了mysql连接池的管理)
因为绝大多数情况下php应用本身初衷不是开发一个应用服务器(后起之秀swoole, 是一个优秀的php应用服务器，不过是在c层面做的,它可以维护mysql连接池).
        
### 解决方案 
### 问题
    
    