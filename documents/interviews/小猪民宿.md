# 小猪民宿

笔试 四十分钟 

正则匹配url
实际场景建表 sql
手写两个排序算法
偶发性报错如何追溯 -》 分布式方向
读代码 写输出 循环引用删除

一面 因该是同事 

输入url过程... 没有什么有价值的问题

二面  应该是java那边的老大

 
 rpc协议
 框架底层原理  
 innodb 与 myisam 的实现区别 ，以及场景区别
 nginx apache iis 进程模型的区别
 nginx 与 swoole的性能区别 

 tars 微服务的整体架构，流程 
 rpc 协议 与 http协议的区别
 压测工具用过那些，ab 关心哪些指标
 如何降低 主从同步的延迟，（主从同步数据延迟问题不可避免，如何降低 不局限于具体场景） 不要回答强制路由到主，这样就失去了意义.
 使用过哪些系统健康检测平台 监控
 安全监控 流量监控
 为什么不使用开原的数据分析 而 自研

 微服务的服务治理 服务调度 服务发现 原理
 linux awk 解析 nginx access.log  

hr 面 

 主要测试个人性格
 这段时间在干嘛
 为什么离职
 上一家薪资
 为什么从教育行业离开
 个人规划  
 你有什么想问我的吗 



## 面试题解析

引用计数与 引用变量 是两个不同的概念

https://www.php.cn/php-weizijiaocheng-409313.html

引用计数 是内存优化场景中的概念. COW 写时复制
引用变量 是内存优化中的概念      多个变量符号指向同一个内存空间 同写


我们经常需要在 foreach 中对变量进行引用,如果操作完毕后 我们没有及时的解除引用.
那么很可能会产生变量污染.

不同的变量名代表不同的内存地址

    $i = 1;
    $j = 1;
    
    $i => 0x0000001
    $j => 0x0000009

两者相互隔离,如果 

    $i = 1;
    $j = &i;

那么  

    $i = 0x0000001
    $j = 0x0000001

两个变量指向同一个内存地址,修改一个变量的值，另外一个同步更新

eg.1

    // 定义一个变量
    $a = range(0, 10000);
    var_dump(memory_get_usage());
    
    // 定义变量b，将a变量的引用赋给b
    $b = &$a;
    var_dump(memory_get_usage());
    
    // 对a进行修改
    $a = range(0, 10000);
    var_dump(memory_get_usage());

result

    int(989760)
    int(989848)
    int(989840)


ANS.6 

首先明确一点，主从数据延迟无法完全消除，只能尽量降低.

主机与备机之间的物理延迟是不可控的，也是无法避免的。但是如果仅仅需要满足这种强一致性，是相对简单的事：
只需要在主机写入时，确认更新已经同步到备机之后，再返回写操作成功即可。主流数据库均支持这种完全的同步模式。
已经有人提到MySQL的Semi-sync功能，就是基于这种原理。
不过，一般不建议使用这种同步模式。显而易见，如果写操作必须等待更新同步完成，肯定会极大地影响性能，除非你不在乎性能。


问题的关键在于，主从架构是一种用于数据容错的高可用性解决方案，而不是一种处理高并发压力的解决方案。
它的目的是主机当机以后备机可以马上顶上，而不是让备机来分担并发压力。
完全同步机制也只是用于保证主机当机以后数据不会丢失，而不是保证从备机读取数据时的一致性。
因此，我根本也不主张你使用从备机读取数据以分担并发压力这种方式。

解决方式是，不要试图在数据库层解决并发的读操作问题，至少不要在主从架构的数据库层解决。
要在数据库层之上架构一个redis这样的分布式缓存来解决，它是专门干这个的。
其性能肯定远高于从备机读取数据。

分布式缓存也存在着一些限制，例如不能完全支持事务处理。
这取决于你的应用场景。对于一般的互联网应用，并发压力大但不要求支持事务，可以考虑分布式缓存。
对于银行这样严格要求强一致性的应用，对于写入延迟一般没什么要求（延迟几个小时都可以接受，数据不出错就行），可以适用完全同步的模式。

基于局域网的master/slave机制在通常情况下已经可以满足'实时'备份的要求了。
如果延迟比较大，首先从以下几个方面排查：
 
1. 网络延迟
2. master负载
3. slave负载

一般的做法是，使用多台slave来分摊读请求，再从这些slave中取一台专用的服务器，只作为备份用，不进行其他任何操作，就能相对最大限度地达到'实时'的要求了



