

# 集群环境下如何做分片的合并

如果后台是集群环境，每一个分片可能是被上传到了不同的节点上， 这时候该如何合并文件？

nginx ip hash策略. 将来自同一个客户端的上传请求打到同一个节点.


分片文件合并方式

 - buffer合并 这种方法简单易理解，但有个最大的缺点，就是你读取的文件有多大，合并的过程占用的内存就有多大，因为我们相当于把这个大文件的全部内容都一次性载入到内存中了，这是非常低效的。
 - stream合并  无需一次性的把这些数据全部放入内存。这使得流在操作大量数据或是数据从外部来源逐段发送过来的时候变得非常有用
 - 文件追加合并  fs.appendFile()的作用是异步地追加数据到一个文件，如果文件不存在则创建文件。data可以是一个字符串或buffer。　　使用这种方法也可以将文件合并，性能强过buffer合并方式，但不及流合并方式。




### 参考资料

 https://blog.csdn.net/diaolangyi8402/article/details/101894498