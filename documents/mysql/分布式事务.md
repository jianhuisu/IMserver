###### 分布式事务支持 

分库分表后，就成了分布式事务了。
如果依赖数据库本身的分布式事务管理功能去执行事务，将付出高昂的性能代价；
如果由应用程序去协助控制，形成程序逻辑上的事务，又会造成编程方面的负担。

##### 分布式存储带来的问题

 - 数据聚合问题
 - UUID问题
 - 数据迁移，容量规划，扩容等
  
 数据聚合问题

跨节点的count,order by,group by,join 以及聚合函数问题 这些是一类问题，
因为它们都需要基于全部数据集合进行计算。多数的代理都不会自动处理合并工作。
解决方案：分别在各个节点上得到结果后在应用程序端进行合并。(虽然对应用层的编程有较大负担,但这也是一个办法)
与join不同的是有些聚合操作中的结点的查询可以**并行执行**，因此很多时候它的速度要比单一大表快很多。
但如果结果集很大，对应用程序内存的消耗是一个问题。

 ID问题

一旦数据库被切分到多个物理结点上，我们将不能再依赖数据库自身的主键生成机制。
一方面，某个分区数据库自生成的ID无法保证在全局上是唯一的；
另一方面，应用程序在插入数据之前需要先获得ID,以便进行SQL路由. 这就涉及到一些常见的主键生成策略.

 数据迁移，容量规划，扩容等

... 这些方案都不是十分的理想，多多少少都存在一些缺点，这也从一个侧面反映出了Sharding扩容的难度。
    
##### 有用到中间件么？他们的原理知道么？

tidb,分布式数据库

CAP定理

 - Consistency          一致性  所有节点在同一时间的数据完全一致，一致性说的就是分布式数据一致性。
 - Availability         可用性   
 - Partition tolerance  分区容错性  分区容错性指分布式系统在遇到某节点或网络分区故障的时候，整体仍然能够对外提供满足一致性和可用性的服务
 
这三个指标不可能同时做到。这个结论就叫做`CAP`定理。

对于关系型数据库，

 - 要求更新过的数据能被后续的访问都能看到，这是强一致性。
 - 如果能容忍后续的部分或者全部访问不到，则是弱一致性。
 - 如果经过一段时间后要求能访问到更新后的数据，则是最终一致性。
    
CAP中说，不可能同时满足的这个一致性指的是强一致性。

`CP without A` 像Zookeeper这种分布式协调组件。数据的一致性是他们最最基本的要求。一个连数据一致性都保证不了的分布式存储要他有何用.(目前还不明白其实现原理,但是应该跟事务实现原理类似)
`AP wihtout C` (获取最终一致性):适合一些对实时要求不那么高的场景,比如新闻,短视频
`CA without P` 不存在,因为节点故障肯定会存在,p无法避免

目前Tidb已经在北京银行进行了广泛的应用.tidb的金融级别可用是指`CP without A`,


