
<html>
<head>
    <title>chatdemo</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1, maximum-scale=1, user-scalable=no">
</head>
<body>
    <div class="show_area" style="">
    </div>
<script src="http://libs.baidu.com/jquery/1.9.1/jquery.min.js"></script>
<script>
    $(function(){
        // 等下去掉后面的 queryString 测试是否只凭端口就可以正常使用
        var wsurl = 'ws://192.168.32.10:19910/socket/websocket.php';
        var websocket;
        var i = 0;
        if(window.WebSocket){
            websocket = new WebSocket(wsurl);

            //连接建立
            websocket.onopen = function(evevt){
                console.log("Connected to WebSocket server.");
                $('.show-area').append('<p class="bg-info message"><i class="glyphicon glyphicon-info-sign"></i>加入聊天成功</p>');
            };
            //收到消息
            websocket.onmessage = function(event) {

                //解析收到的json消息数据
                var msg = JSON.parse(event.data);
                console.log('receive message from server: '+msg);
                window.location.hash = '#'+i;
            };

            //发生错误
            websocket.onerror = function(event){
                i++;
                console.log("Connected to WebSocket server error");
                $('.show-area').append('<p class="bg-danger message"><a name="'+i+'"></a><i class="glyphicon glyphicon-info-sign"></i>Connect to WebSocket server error.</p>');
                window.location.hash = '#'+i;
            };

            //连接关闭
            websocket.onclose = function(event){
                i++;
                console.log('websocket Connection Closed. ');
                $('.show-area').append('<p class="bg-warning message"><a name="'+i+'"></a><i class="glyphicon glyphicon-info-sign"></i>退出聊天.</p>');
                window.location.hash = '#'+i;
            };

            function send(){
               var msg = 'this is '+ i +' message';
                i++;
                console.info(msg);
                try{
                    websocket.send(JSON.stringify(msg));
                } catch(ex) {
                    console.warn(ex);
                }

            }

            //按下enter键发送消息
            $(window).keydown(function(event){
                if(event.keyCode == 13){
                    console.log('user enter');
                    send();
                }
            });

        } else {
            alert('该浏览器不支持web socket');
        }

    });
</script>
</body>
</html>