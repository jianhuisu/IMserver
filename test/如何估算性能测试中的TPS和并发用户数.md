## 如何估算性能测试中的TPS和并发用户数.

### 1. 进行估算是需要基础数据支持的.

 - PV/UV

如果我们知道系统的PV,那么我们可以估算出高峰期的并发数.
如果我们知道系统的最大TPS,以及客户要求的目标QPS.那么我们就可以预估出需要增加多少台机器才能支撑峰值流量.

假设一个系统的业务有登录、浏览帖子、发送新帖、回复帖子，访问高峰是上午10点，日访问高峰PV约5208

 - 登录1300 
 - 浏览2706
 - 发帖526
 - 回帖676

系统响应时间要求小于3秒，试计算此系统的TPS以及并发数。

如果分析业务量的数据是以PV来统计的，我们需要把PV转化为TPS。

实际上一个PV即一次对服务器的客户请求，可能还包含了很多资源请求，比如图片、样式、JS信息、文字等。
而浏览器具有资源缓存功能，下次访问同样资源将不会再从远程服务器上下载，这大大加快了响应速度。
如果我们使用代理服务器访问外网资源时，多数代理服务器也会缓存这些静态数据。

所以浏览器是否缓存了静态数据对性能测试影响明显。我们在做性能测试时，其中就有许多用户可能是新用户，
在他们的浏览器上还没有缓存这些静态数据，为了更准确的模拟用户请求，我们有必要不缓存这些静态内容。
所以性能测试中是否缓存访问的静态资源要根据业务情况而定。

本例中，我们把一个请求放在一个事务中来统计服务器的响应时间。这么说，一个PV即是一个事务,实际上每秒的PV量并不直接等同于TPS， 因为一次客户请求可能包含了很多资源请求。
如果我们不关心页面刷新时请求资源的耗时，此时我们就把每秒PV数等同于TPS。
比如一个功能页面（浏览帖子，MVC模式中称为一个事务其实也没毛病）每秒会有10个PV，那么此功能的TPS即为10。

### 2. 估算峰值TPS

业务量一般要取系统业务高峰的值，才能代表系统的实际处理能力。系统在10点的访问高峰PV约5208，那么这个时段的`TPS=5208/3600≈1.45`吗？
答案是否定的，因为在一小时内的吞吐量未必是平均的。

如果我们采集到的业务量数据能够细分到每分钟，TPS就越准确。如果不能，可以按照二八原则。即80％的业务在20%的时间内完成，

    TPS=（520880%)/(360020%)≈5.8。

### 3. 估算可以支持的并发数

 1. 由TPS进行估算
 1. 由在线活动用户数估算
 1. 根据经验估算

这里我们采用第一种方法.

因为`TPS=事务数/时间`，假设所有的事务都来自不同的用户，那么此时:`并发数=事务数=TPS*时间`。具体如下：

    Vu（业务名称）= TPS（业务名称）*（Runtime+ThinkTime）

其中

 - Vu（业务名称）表示此业务的虚拟用户数，即并发数。
 - RunTime是测试程序/脚本运行一次所消耗的时间，包括事务时间+非事务时间。
 - ThinkTime是模拟用户思考或者填写表单消耗的时间。


### 备注

这里的计算公式还没吃透 等待完善.